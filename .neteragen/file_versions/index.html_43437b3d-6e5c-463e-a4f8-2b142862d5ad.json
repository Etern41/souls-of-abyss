{
  "file_name": "index.html",
  "revision_id": "43437b3d-6e5c-463e-a4f8-2b142862d5ad",
  "metadata": {
    "timestamp": "2025-12-09T13:58:24.275329",
    "type": "cache_version",
    "source": "ToolTextFileEdit",
    "size": 15810,
    "is_reverted": false,
    "git_branch_name": "",
    "agent_name": "Many",
    "description": "create index.html per PROMPT #2"
  },
  "content": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n  <title>Souls of the Abyss</title>\n  <style>\n    :root {\n      color-scheme: dark;\n      --accent: #c41e3a;\n      --bg: #0a0a0f;\n      --panel: rgba(10, 10, 15, 0.75);\n      --text: #f4f4f4;\n      --muted: #8c92ac;\n      --border: rgba(196, 30, 58, 0.4);\n    }\n\n    * {\n      box-sizing: border-box;\n    }\n\n    body {\n      margin: 0;\n      min-height: 100vh;\n      background: radial-gradient(circle at top, #1a0327, #0a0a0f 55%);\n      color: var(--text);\n      font-family: \"Segoe UI\", \"Inter\", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      padding: 20px;\n    }\n\n    .app-shell {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 20px;\n      width: 100%;\n      max-width: 1400px;\n      align-items: flex-start;\n    }\n\n    .panel {\n      background: var(--panel);\n      border: 1px solid var(--border);\n      border-radius: 16px;\n      padding: 20px;\n      flex: 1 1 320px;\n      backdrop-filter: blur(8px);\n      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.45);\n    }\n\n    .panel h1 {\n      margin: 0 0 10px;\n      font-size: 1.8rem;\n      letter-spacing: 0.08em;\n      text-transform: uppercase;\n    }\n\n    .panel p {\n      margin-top: 0;\n      color: var(--muted);\n    }\n\n    .character-buttons {\n      display: flex;\n      gap: 12px;\n      flex-wrap: wrap;\n      margin-top: 16px;\n    }\n\n    .character-buttons button {\n      flex: 1 1 90px;\n      padding: 12px 16px;\n      border-radius: 10px;\n      border: 1px solid var(--border);\n      background: rgba(196, 30, 58, 0.15);\n      color: var(--text);\n      text-transform: uppercase;\n      letter-spacing: 0.05em;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      font-weight: 600;\n    }\n\n    .character-buttons button:hover,\n    .character-buttons button.active {\n      background: var(--accent);\n      box-shadow: 0 0 14px rgba(196, 30, 58, 0.5);\n    }\n\n    canvas {\n      display: block;\n      border-radius: 18px;\n      border: 2px solid var(--border);\n      max-width: 100%;\n      background: #030205;\n    }\n\n    .canvas-wrapper {\n      position: relative;\n      display: inline-block;\n    }\n\n    #hud {\n      position: absolute;\n      top: 16px;\n      left: 16px;\n      width: 240px;\n      padding: 16px;\n      background: rgba(0, 0, 0, 0.45);\n      border-radius: 12px;\n      border: 1px solid rgba(255, 255, 255, 0.08);\n      font-size: 0.9rem;\n      line-height: 1.6;\n    }\n\n    .hud-row {\n      display: flex;\n      justify-content: space-between;\n      gap: 8px;\n    }\n\n    .hud-row span:last-child {\n      color: var(--accent);\n      font-weight: 600;\n    }\n\n    .health-bar {\n      margin-top: 10px;\n    }\n\n    .health-bar-label {\n      display: flex;\n      justify-content: space-between;\n      font-size: 0.85rem;\n    }\n\n    .health-bar-track {\n      margin-top: 6px;\n      width: 100%;\n      height: 12px;\n      border-radius: 999px;\n      background: rgba(255, 255, 255, 0.1);\n      overflow: hidden;\n    }\n\n    .health-bar-fill {\n      height: 100%;\n      width: 0%;\n      background: linear-gradient(90deg, #ff4d6d, #c41e3a);\n      transition: width 0.15s ease;\n    }\n\n    .controls-hint {\n      margin-top: 20px;\n      padding: 12px;\n      border-radius: 10px;\n      border: 1px dashed rgba(255, 255, 255, 0.15);\n      font-size: 0.85rem;\n      color: var(--muted);\n    }\n\n    .controls-hint code {\n      color: var(--accent);\n      background: rgba(196, 30, 58, 0.12);\n      padding: 2px 6px;\n      border-radius: 6px;\n      font-weight: 600;\n    }\n\n    .death-modal {\n      position: fixed;\n      inset: 0;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: rgba(0, 0, 0, 0.75);\n      z-index: 99;\n      transition: opacity 0.2s ease;\n    }\n\n    .death-modal.hidden {\n      pointer-events: none;\n      opacity: 0;\n    }\n\n    .death-card {\n      background: #150312;\n      border: 1px solid var(--border);\n      border-radius: 20px;\n      padding: 32px;\n      width: min(90vw, 420px);\n      text-align: center;\n      box-shadow: 0 25px 50px rgba(196, 30, 58, 0.35);\n    }\n\n    .death-card h2 {\n      margin: 0 0 10px;\n      letter-spacing: 0.1em;\n      text-transform: uppercase;\n    }\n\n    .death-card p {\n      margin: 6px 0;\n      color: var(--muted);\n    }\n\n    .death-card strong {\n      color: var(--accent);\n    }\n\n    #restartBtn {\n      margin-top: 20px;\n      width: 100%;\n      padding: 12px 16px;\n      border-radius: 12px;\n      border: none;\n      background: var(--accent);\n      color: var(--text);\n      font-size: 1rem;\n      cursor: pointer;\n      text-transform: uppercase;\n      letter-spacing: 0.08em;\n      font-weight: 700;\n      box-shadow: 0 15px 35px rgba(196, 30, 58, 0.35);\n    }\n\n    .sprite-preload {\n      position: absolute;\n      width: 0;\n      height: 0;\n      overflow: hidden;\n    }\n\n    .sprite-preload img {\n      display: none;\n    }\n\n    @media (max-width: 1200px) {\n      body {\n        padding: 10px;\n      }\n\n      .canvas-wrapper {\n        width: 100%;\n      }\n\n      canvas {\n        width: 100%;\n        height: auto;\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"app-shell\">\n    <section class=\"panel\">\n      <h1>Souls of the Abyss</h1>\n      <p>Choose a champion to begin the assault. Each hero carries unique stats and signature abilities.</p>\n      <div class=\"character-buttons\">\n        <button type=\"button\" data-char=\"knight\" onclick=\"selectChar('knight')\">Knight</button>\n        <button type=\"button\" data-char=\"witch\" onclick=\"selectChar('witch')\">Witch</button>\n        <button type=\"button\" data-char=\"rogue\" onclick=\"selectChar('rogue')\">Rogue</button>\n      </div>\n      <div class=\"controls-hint\">\n        <div><strong>Controls</strong></div>\n        <div><code>WASD</code> to move</div>\n        <div><code>E</code> for Godsayer Sword (costs Essence)</div>\n      </div>\n    </section>\n\n    <section class=\"panel canvas-wrapper\">\n      <canvas id=\"gameCanvas\" width=\"1000\" height=\"600\" aria-label=\"Souls of the Abyss field\"></canvas>\n      <div id=\"hud\">\n        <div class=\"hud-row\"><span>Time</span><span id=\"hudTime\">0.0s</span></div>\n        <div class=\"hud-row\"><span>Level</span><span id=\"hudLevel\">1</span></div>\n        <div class=\"hud-row\"><span>Armor</span><span id=\"hudArmor\">0</span></div>\n        <div class=\"hud-row\"><span>Wave</span><span id=\"hudWave\">0</span></div>\n        <div class=\"hud-row\"><span>Enemies</span><span id=\"hudEnemies\">0</span></div>\n        <div class=\"hud-row\"><span>Essence</span><span id=\"hudEssence\">0 (+0/5)</span></div>\n        <div class=\"hud-row\"><span>Boss Timer</span><span id=\"hudBoss\">120.0s</span></div>\n        <div class=\"health-bar\">\n          <div class=\"health-bar-label\">\n            <span>HP</span>\n            <span id=\"hudHealthText\">0 / 0</span>\n          </div>\n          <div class=\"health-bar-track\">\n            <div id=\"hudHealthFill\" class=\"health-bar-fill\"></div>\n          </div>\n        </div>\n      </div>\n    </section>\n  </div>\n\n  <div id=\"deathScreen\" class=\"death-modal hidden\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"deathTitle\">\n    <div class=\"death-card\">\n      <h2 id=\"deathTitle\">Fallen Champion</h2>\n      <p>Survived: <strong id=\"statTime\">0.0s</strong></p>\n      <p>Kills: <strong id=\"statKills\">0</strong></p>\n      <p>Level Reached: <strong id=\"statLevel\">1</strong></p>\n      <p>Essence Collected: <strong id=\"statEssence\">0</strong></p>\n      <button id=\"restartBtn\" type=\"button\">Restart</button>\n    </div>\n  </div>\n\n  <div class=\"sprite-preload\" aria-hidden=\"true\">\n    <img id=\"spriteKnight\" src=\"sprites/knight.png\" alt=\"Knight sprite\" />\n    <img id=\"spriteWitch\" src=\"sprites/witch.png\" alt=\"Witch sprite\" />\n    <img id=\"spriteRogue\" src=\"sprites/rogue.png\" alt=\"Rogue sprite\" />\n    <img id=\"spriteZombie\" src=\"sprites/zombie.png\" alt=\"Zombie sprite\" />\n    <img id=\"spriteSpectre\" src=\"sprites/spectre.png\" alt=\"Spectre sprite\" />\n    <img id=\"spriteCultist\" src=\"sprites/cultist.png\" alt=\"Cultist sprite\" />\n    <img id=\"spriteVampire\" src=\"sprites/vampire.png\" alt=\"Vampire sprite\" />\n    <img id=\"spriteWraith\" src=\"sprites/wraith.png\" alt=\"Wraith sprite\" />\n    <img id=\"spriteCorruptedKnight\" src=\"sprites/corrupted_knight.png\" alt=\"Corrupted Knight sprite\" />\n    <img id=\"spriteWarden\" src=\"sprites/warden.png\" alt=\"Warden sprite\" />\n    <img id=\"spriteShadowLord\" src=\"sprites/shadow_lord.png\" alt=\"Shadow Lord sprite\" />\n    <img id=\"spriteVoidRift\" src=\"sprites/void_rift.png\" alt=\"Void Rift sprite\" />\n    <img id=\"spriteAncientOne\" src=\"sprites/ancient_one.png\" alt=\"Ancient One sprite\" />\n    <img id=\"spriteParticles\" src=\"sprites/particles.png\" alt=\"Particles sprite\" />\n    <img id=\"spriteMap\" src=\"sprites/map.png\" alt=\"Map sprite\" />\n  </div>\n\n  <script src=\"game.js\"></script>\n  <script>\n    (function () {\n      const spriteIds = [\n        \"spriteKnight\",\n        \"spriteWitch\",\n        \"spriteRogue\",\n        \"spriteZombie\",\n        \"spriteSpectre\",\n        \"spriteCultist\",\n        \"spriteVampire\",\n        \"spriteWraith\",\n        \"spriteCorruptedKnight\",\n        \"spriteWarden\",\n        \"spriteShadowLord\",\n        \"spriteVoidRift\",\n        \"spriteAncientOne\",\n        \"spriteParticles\",\n        \"spriteMap\"\n      ];\n\n      const hudRefs = {\n        time: document.getElementById(\"hudTime\"),\n        level: document.getElementById(\"hudLevel\"),\n        armor: document.getElementById(\"hudArmor\"),\n        wave: document.getElementById(\"hudWave\"),\n        enemies: document.getElementById(\"hudEnemies\"),\n        essence: document.getElementById(\"hudEssence\"),\n        boss: document.getElementById(\"hudBoss\"),\n        healthText: document.getElementById(\"hudHealthText\"),\n        healthFill: document.getElementById(\"hudHealthFill\")\n      };\n\n      const statRefs = {\n        time: document.getElementById(\"statTime\"),\n        kills: document.getElementById(\"statKills\"),\n        level: document.getElementById(\"statLevel\"),\n        essence: document.getElementById(\"statEssence\")\n      };\n\n      const deathModal = document.getElementById(\"deathScreen\");\n      const restartBtn = document.getElementById(\"restartBtn\");\n      const characterButtons = document.querySelectorAll(\".character-buttons button\");\n\n      const pressedKeys = new Set();\n      const movementKeys = new Set([\"w\", \"a\", \"s\", \"d\"]);\n      let hudLoopStarted = false;\n      let currentCharacter = null;\n\n      function loadSprites() {\n        spriteIds.forEach((id) => {\n          const img = document.getElementById(id);\n          if (!img) return;\n          if (!img.complete) {\n            img.loading = \"eager\";\n          }\n        });\n      }\n\n      function clamp(value, min, max) {\n        return Math.max(min, Math.min(max, value));\n      }\n\n      function refreshHUD() {\n        const state = window.gameState;\n        if (!state || !state.player) {\n          hudRefs.time.textContent = \"0.0s\";\n          hudRefs.level.textContent = \"-\";\n          hudRefs.armor.textContent = \"-\";\n          hudRefs.wave.textContent = \"-\";\n          hudRefs.enemies.textContent = \"-\";\n          hudRefs.essence.textContent = \"0 (+0/5)\";\n          hudRefs.boss.textContent = \"120.0s\";\n          hudRefs.healthText.textContent = \"0 / 0\";\n          hudRefs.healthFill.style.width = \"0%\";\n          return;\n        }\n\n        const enemiesAlive = state.enemies.filter((enemy) => enemy.alive).length;\n        const bossCountdown = clamp(120 - state.bossTimer, 0, 120);\n        const player = state.player;\n        const hpRatio = player.maxHealth > 0 ? player.health / player.maxHealth : 0;\n\n        hudRefs.time.textContent = `${state.gameTime.toFixed(1)}s`;\n        hudRefs.level.textContent = player.level;\n        hudRefs.armor.textContent = player.armor;\n        hudRefs.wave.textContent = state.waveNumber;\n        hudRefs.enemies.textContent = enemiesAlive;\n        hudRefs.essence.textContent = `${state.weaponCharges} (+${state.essenceCollected}/5)`;\n        hudRefs.boss.textContent = `${bossCountdown.toFixed(1)}s`;\n        hudRefs.healthText.textContent = `${Math.max(player.health, 0).toFixed(0)} / ${player.maxHealth}`;\n        hudRefs.healthFill.style.width = `${clamp(hpRatio, 0, 1) * 100}%`;\n      }\n\n      function animateHUD() {\n        refreshHUD();\n        window.requestAnimationFrame(animateHUD);\n      }\n\n      function ensureHudLoop() {\n        if (!hudLoopStarted) {\n          hudLoopStarted = true;\n          animateHUD();\n        }\n      }\n\n      function setActiveCharacterButton(character) {\n        characterButtons.forEach((btn) => {\n          if (btn.dataset.char === character) {\n            btn.classList.add(\"active\");\n          } else {\n            btn.classList.remove(\"active\");\n          }\n        });\n      }\n\n      function selectChar(character) {\n        if (typeof window.initGame === \"function\") {\n          window.initGame(character);\n        }\n        currentCharacter = character;\n        setActiveCharacterButton(character);\n        hideDeathScreen();\n        ensureHudLoop();\n      }\n\n      function hideDeathScreen() {\n        if (!deathModal.classList.contains(\"hidden\")) {\n          deathModal.classList.add(\"hidden\");\n        }\n      }\n\n      function showDeathScreen(state) {\n        if (!state) return;\n        statRefs.time.textContent = `${state.gameTime.toFixed(1)}s`;\n        statRefs.kills.textContent = state.enemiesKilled;\n        statRefs.level.textContent = state.player ? state.player.level : 0;\n        statRefs.essence.textContent = state.weaponCharges;\n        deathModal.classList.remove(\"hidden\");\n      }\n\n      function restartGame() {\n        if (currentCharacter) {\n          selectChar(currentCharacter);\n        }\n      }\n\n      function syncMovementKey(key, isDown) {\n        if (typeof window.setKeyState === \"function\") {\n          window.setKeyState(key, isDown);\n        } else if (window.gameState && window.gameState.keys && key in window.gameState.keys) {\n          window.gameState.keys[key] = isDown;\n        }\n      }\n\n      function setEssenceKey(isDown) {\n        if (window.gameState && window.gameState.keys) {\n          window.gameState.keys.e = isDown;\n        }\n      }\n\n      function tryGodsayer() {\n        const state = window.gameState;\n        if (!state || !state.player || !state.alive) {\n          return;\n        }\n        if (state.weaponCharges <= 0) {\n          return;\n        }\n        if (typeof window.triggerGodsayerSword === \"function\") {\n          window.triggerGodsayerSword();\n        }\n      }\n\n      document.addEventListener(\"keydown\", (event) => {\n        const key = event.key.toLowerCase();\n        if (movementKeys.has(key)) {\n          event.preventDefault();\n          if (!pressedKeys.has(key)) {\n            pressedKeys.add(key);\n            syncMovementKey(key, true);\n          }\n        } else if (key === \"e\") {\n          event.preventDefault();\n          if (!pressedKeys.has(\"e\")) {\n            pressedKeys.add(\"e\");\n            setEssenceKey(true);\n            tryGodsayer();\n          }\n        }\n      });\n\n      document.addEventListener(\"keyup\", (event) => {\n        const key = event.key.toLowerCase();\n        if (movementKeys.has(key)) {\n          pressedKeys.delete(key);\n          syncMovementKey(key, false);\n        } else if (key === \"e\") {\n          pressedKeys.delete(\"e\");\n          setEssenceKey(false);\n        }\n      });\n\n      restartBtn.addEventListener(\"click\", restartGame);\n\n      window.loadSprites = loadSprites;\n      window.selectChar = selectChar;\n      window.updateHUD = refreshHUD;\n      window.showDeathScreen = showDeathScreen;\n\n      loadSprites();\n      ensureHudLoop();\n    })();\n  </script>\n</body>\n</html>\n",
  "saved_at": "2025-12-09T13:58:24.275329"
}